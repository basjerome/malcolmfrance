!function($){$(function(){function a(a){$(a).attr("disabled")&&$(a).removeAttr("disabled"),$(a).parent().parent().hasClass("envira-addon-not-installed")&&$(a).text(envira_gallery_addons.install)}var n;$("form#add-on-search input#add-on-searchbox").on("keyup",function(){clearTimeout(n);var a=$(this),e=$(a).val().toLowerCase(),i=$(a).data("heading"),r=$(a).data("results"),t=$(a).data("cancel");return $("form#add-on-search .spinner").css("visibility","visible"),e.length<3?void $("div.envira-addon").fadeIn("fast",function(){$("form#add-on-search .spinner").css("visibility","hidden")}):($("div.envira-addon").each(function(){$("h3.envira-addon-title",$(this)).text().toLowerCase().search(e)>=0?$(this).fadeIn():$(this).fadeOut()}),void $("form#add-on-search .spinner").css("visibility","hidden"))});var e=new List("envira-addons-licensed",{valueNames:["envira-addon-title"]}),i=new List("envira-addons-unlicensed",{valueNames:["envira-addon-title"]});$("select#envira-filter-select").on("change",function(){"undefined"!=typeof e.sort&&e.sort("envira-addon-title",{order:$(this).val()}),"undefined"!=typeof i.sort&&i.sort("envira-addon-title",{order:$(this).val()})}),$("#envira-addons").on("click.refreshInstallAddon",".envira-addon-action-button",function(n){var e=$(this),i=$("#envira-addons").find(".envira-addon-action-button");$.each(i,function(n,i){return e==i?!0:void a(i)})}),$("#envira-addons").on("click.activateAddon",".envira-activate-addon",function(a){a.preventDefault();var n=$(this);$(".envira-addon-error").remove(),$(this).html('<i class="envira-toggle-on"></i> '+envira_gallery_addons.activating),$(this).next().css({display:"inline-block","margin-top":"0px"});var e=$(this),i=$(this).attr("rel"),r=$(this).parent().parent(),t=$(this).parent().parent().find(".addon-status"),d={url:ajaxurl,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_gallery_activate_addon",nonce:envira_gallery_addons.activate_nonce,plugin:i},success:function(a){if(a&&!0!==a)return void $(r).slideDown("normal",function(){$(this).after('<div class="envira-addon-error"><strong>'+a.error+"</strong></div>"),n.next().hide(),$(".envira-addon-error").delay(3e3).slideUp()});$(e).html('<i class="envira-toggle-on"></i> '+envira_gallery_addons.deactivate).removeClass("envira-activate-addon").addClass("envira-deactivate-addon"),$(t).text(envira_gallery_addons.active);var i=$(t),d,o,s;d=i.html().split(/\s+/),o=d.pop(),s=d.join(" "),i.html([s," <span>",o,"</span>"].join("")),$(r).removeClass("envira-addon-inactive").addClass("envira-addon-active"),n.next().hide()},error:function(a,e,i){n.next().hide()}};$.ajax(d)}),$("#envira-addons").on("click.deactivateAddon",".envira-deactivate-addon",function(a){a.preventDefault();var n=$(this);$(".envira-addon-error").remove(),$(this).html('<i class="envira-toggle-on"></i> '+envira_gallery_addons.deactivating),$(this).next().css({display:"inline-block","margin-top":"0px"});var e=$(this),i=$(this).attr("rel"),r=$(this).parent().parent(),t=$(this).parent().parent().find(".addon-status"),d={url:ajaxurl,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_gallery_deactivate_addon",nonce:envira_gallery_addons.deactivate_nonce,plugin:i},success:function(a){if(a&&!0!==a)return void $(r).slideDown("normal",function(){$(this).after('<div class="envira-addon-error"><strong>'+a.error+"</strong></div>"),n.next().hide(),$(".envira-addon-error").delay(3e3).slideUp()});$(e).html('<i class="envira-toggle-on"></i> '+envira_gallery_addons.activate).removeClass("envira-deactivate-addon").addClass("envira-activate-addon"),$(t).text(envira_gallery_addons.inactive);var i=$(t),d,o,s;d=i.html().split(/\s+/),o=d.pop(),s=d.join(" "),i.html([s," <span>",o,"</span>"].join("")),$(r).removeClass("envira-addon-active").addClass("envira-addon-inactive"),n.next().hide()},error:function(a,e,i){n.next().hide()}};$.ajax(d)}),$("#envira-addons").on("click.installAddon",".envira-install-addon",function(a){a.preventDefault();var n=$(this);$(".envira-addon-error").remove(),$(this).html('<i class="envira-cloud-download"></i> '+envira_gallery_addons.installing),$(this).next().css({display:"inline-block","margin-top":"0px"});var e=$(this),i=$(this).attr("rel"),r=$(this).parent().parent(),t=$(this).parent().parent().find(".addon-status"),d={url:ajaxurl,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_gallery_install_addon",nonce:envira_gallery_addons.install_nonce,plugin:i},success:function(a){if(a.error)return void $(r).slideDown("normal",function(){$(e).parent().parent().after('<div class="envira-addon-error"><div class="xinterior"><p><strong>'+a.error+"</strong></p></div></div>"),$(e).html('<i class="envira-cloud-download"></i> '+envira_gallery_addons.install),n.next().hide(),$(".envira-addon-error").delay(4e3).slideUp()});if(a.form)return $(r).slideDown("normal",function(){$(this).after('<div class="envira-addon-error">'+a.form+"</div>"),n.next().hide()}),$(e).attr("disabled",!0),void $("#envira-addons").on("click.installCredsAddon","#upgrade",function(a){a.preventDefault(),n.next().hide(),$(this).html('<i class="envira-cloud-download"></i> '+envira_gallery_addons.installing),$(this).next().css({display:"inline-block","margin-top":"0px"});var d=$(this).parent().parent().find("#hostname").val(),o=$(this).parent().parent().find("#username").val(),s=$(this).parent().parent().find("#password").val(),l=$(this),v=$(this).parent().parent().parent().parent(),c={url:ajaxurl,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_gallery_install_addon",nonce:envira_gallery_addons.install_nonce,plugin:i,hostname:d,username:o,password:s},success:function(a){if(a.error)return void $(r).slideDown("normal",function(){$(e).parent().parent().after('<div class="envira-addon-error"><strong>'+a.error+"</strong></div>"),$(e).html('<i class="envira-cloud-download"></i> '+envira_gallery_addons.install),n.next().hide(),$(".envira-addon-error").delay(4e3).slideUp()});if(a.form)return n.next().hide(),$(".envira-inline-error").remove(),$(l).val(envira_gallery_addons.proceed),void $(l).after('<span class="envira-inline-error">'+envira_gallery_addons.connect_error+"</span>");$(v).remove(),$(e).show(),$(e).text(envira_gallery_addons.activate).removeClass("envira-install-addon").addClass("envira-activate-addon"),$(e).attr("rel",a.plugin),$(e).removeAttr("disabled"),$(t).text(envira_gallery_addons.inactive);var i=$(t),d,o,s;d=i.html().split(/\s+/),o=d.pop(),s=d.join(" "),i.html([s," <span>",o,"</span>"].join("")),$(r).removeClass("envira-addon-not-installed").addClass("envira-addon-inactive"),n.next().hide()},error:function(a,e,i){n.next().hide()}};$.ajax(c)});$(e).html('<i class="envira-toggle-on"></i> '+envira_gallery_addons.activate).removeClass("envira-install-addon").addClass("envira-activate-addon"),$(e).attr("rel",a.plugin),$(t).text(envira_gallery_addons.inactive);var d=$(t),o,s,l;o=d.html().split(/\s+/),s=o.pop(),l=o.join(" "),d.html([l," <span>",s,"</span>"].join("")),$(r).removeClass("envira-addon-not-installed").addClass("envira-addon-inactive"),n.next().hide()},error:function(a,e,i){n.next().hide()}};$.ajax(d)})})}(jQuery);